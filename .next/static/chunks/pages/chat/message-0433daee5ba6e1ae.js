(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[800],{3008:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/message",function(){return a(5103)}])},935:function(e,t,a){"use strict";var s=a(6809),r=a.n(s);let l=r()("https://api.app-book.co.uk");t.Z=l},5103:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(5893),r=a(7294);let l=r.forwardRef(function({title:e,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":t},a),e?r.createElement("title",{id:t},e):null,r.createElement("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"}))});var n=a(2913);let i=r.forwardRef(function({title:e,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":t},a),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"}))});var c=a(3144),o=a(4104),d=a(9473),u=a(6367),f=a(381),m=a.n(f),h=a(1163),x=a(935);function w(){let e=(0,r.useRef)(null),t=(0,h.useRouter)(),{user:a}=(0,d.v9)(e=>e.auth),{to:f,from:w,business_id:p,business_name:v}=t.query,[g,j]=(0,r.useState)([]),[b,y]=(0,r.useState)(),[N,_]=(0,r.useState)("");function k(e){let t={message_id:x.Z.id,business_id:p,from:a._id,to:f,sent:!0,recieve:!1,avatar:a.avatar,message:N,image:e,createdAt:new Date};x.Z.emit("send-message",t),_("")}async function E(t){let a=t.target.files[0],s=new FormData;a&&s.append("images",a),await o.Z.post("/api/v1/chat/upload",s).then(t=>{e.current.value=null,k(t.data.url)}).catch(e=>console.log(e))}return((0,r.useEffect)(()=>{async function e(){await o.Z.get("/api/v1/chat/getAllMessages?from=".concat(w,"&to=").concat(f,"&business_id=").concat(p)).then(e=>j([...e.data.msgs]))}x.Z.on("receive-message",e=>y(e)),t.isReady&&e()},[t.isReady]),(0,r.useEffect)(()=>{b&&j([...g,b])},[b]),(0,r.useEffect)(()=>{a||t.push("/login")},[a]),a)?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex felx-col h-0 flex-grow w-full justify-center py-8 px-2",children:(0,s.jsxs)("div",{className:"flex flex-col w-full max-w-3xl items-center bg-white rounded-lg shadow-md",children:[(0,s.jsxs)("div",{className:"w-full max-w-xl mt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between w-full items-center px-4",children:[(0,s.jsx)("button",{onClick:()=>t.push("/chat"),children:(0,s.jsx)(n.Z,{className:" text-primary-500 w-5 h-5"})}),(0,s.jsx)("div",{className:"tex-lg font-semibold whitespace-nowrap truncate",children:v}),(0,s.jsxs)("div",{className:"flex justify-center items-center w-6 h-6 bg-white border border-primary-500 rounded-md shadow text-white",children:[(0,s.jsx)("button",{onClick:()=>e.current.click(),children:(0,s.jsx)(l,{className:"w-5 h-5 text-primary-500"})}),(0,s.jsx)("input",{type:"file",className:"hidden",ref:e,onChange:E,accept:"image/jpg, image/jpeg"})]})]}),(0,s.jsx)("p",{className:"border-b w-full max-w-xl m-3"})]}),(0,s.jsx)("div",{className:"flex relative h-0 flex-grow flex-col-reverse gap-4 w-full overflow-y-auto scrollboxmenu px-4 lg:px-10",children:(0,u.g)(g).map((e,t)=>{var r;return(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"sticky z-20 top-1 text-sm font-semibold text-center py-2",children:(0,s.jsx)("span",{className:"bg-white px-4 py-1 rounded-full",children:e.date})}),null===(r=e.chats)||void 0===r?void 0:r.map((e,t)=>{var r;return(0,s.jsx)("div",{className:"flex ".concat(e._id!=(null==a?void 0:a._id)?"justify-end":"justify-start"," w-full"),children:(0,s.jsxs)("div",{className:"flex ".concat(e._id===(null==a?void 0:a._id)?"flex-row-reverse":""," w-full justify-start items-center max-w-xs lg:max-w-md"),children:[(0,s.jsxs)("div",{className:"w-full h-auto max-h-96",children:[e.image?(0,s.jsx)("div",{className:"relative z-0 h-80 w-auto rounded-lg overflow-hidden my-4",children:(0,s.jsx)(c.Z,{src:e.image,alt:"",fill:!0,className:"object-contain rounded-xl overflow-hidden"})}):"",e.text||e.message?(0,s.jsx)("p",{className:"p-2 w-full h-full ".concat(e._id!=a._id?"bg-primary-400 rounded-tr-2xl":"bg-gray-300 rounded-tl-2xl"," text-white leading-tight"),children:e.text?e.text:e.message}):"",(0,s.jsx)("p",{className:"text-xs ".concat(e._id!=a._id?"text-right":"text-left"),children:m()(e.createdAt).format("LT")})]}),(0,s.jsx)("div",{className:"flex items-center p-2",children:(0,s.jsx)("div",{className:"relative w-10 h-10 bg-primary-100 rounded-full overflow-hidden",children:(0,s.jsx)(c.Z,{src:e._id!=a._id?null==a?void 0:a.avatar:null==e?void 0:null===(r=e.business_id)||void 0===r?void 0:r.business_avatar,alt:"",fill:!0,className:"object-cover"})})})]})},t)})]},t)})}),(0,s.jsxs)("div",{className:"flex w-full focus-within:ring focus-within:ring-primary-500 focus-within:ring-opacity-30 border rounded-md focus-within:border-primary-500 overflow-hidden p-3",children:[(0,s.jsx)("input",{value:N,onChange:e=>_(e.target.value),className:"w-full focus:outline-none pl-4",placeholder:"your message"}),(0,s.jsx)("button",{disabled:!N,onClick:()=>k(""),className:"flex justify-center items-center w-6 h-6 bg-primary-100 rounded-sm text-white",children:(0,s.jsx)(i,{className:"w-4 h-4 text-primary-500"})})]})]})})}):null}},6367:function(e,t,a){"use strict";function s(e,t){return e.to._id===t._id?e.from:e.to}function r(e){let t=e.reduce((e,t)=>{let a=new Date(t.createdAt).toDateString();return e[a]||(e[a]=[]),e[a].push(t),e},{}),a=Object.keys(t).map(e=>({date:e,chats:t[e]})),s=a.sort((e,t)=>Number(new Date(t.date))-Number(new Date(e.date)));return s}a.d(t,{g:function(){return r},m:function(){return s}})},7020:function(){},2913:function(e,t,a){"use strict";var s=a(7294);let r=s.forwardRef(function({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"}))});t.Z=r}},function(e){e.O(0,[809,774,888,179],function(){return e(e.s=3008)}),_N_E=e.O()}]);